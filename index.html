<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>åœ°ç†ãŠåŠ©ã‘ãƒ„ãƒ¼ãƒ« Pro</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#111;
    color:white;
    display:flex;
    height:100vh;
}

/* å·¦ãƒ¢ãƒ¼ãƒ‰ */
#sidebar{
    width:220px;
    background:#1a1a1a;
    padding:15px;
    border-right:2px solid #333;
}

#sidebar h2{
    font-size:18px;
}

.modeBtn{
    display:block;
    width:100%;
    margin:8px 0;
    padding:10px;
    background:#222;
    border:none;
    color:white;
    cursor:pointer;
}

.modeBtn:hover{
    background:#333;
}

/* å³æ“ä½œ */
#main{
    flex:1;
    padding:20px;
    display:flex;
    flex-direction:column;
}

#controls{
    margin-bottom:15px;
}

input,select,button{
    padding:8px;
    margin:5px;
}

button{
    cursor:pointer;
}

#map{
    flex:1;
    margin-top:10px;
}

#result img{
    width:150px;
}
</style>
</head>

<body>

<!-- å·¦ -->
<div id="sidebar">
    <h2>ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</h2>
    <button class="modeBtn" onclick="setMode('country')">å›½æ¤œç´¢</button>
    <button class="modeBtn" onclick="setMode('region')">åœ°åŸŸæ¤œç´¢</button>
    <button class="modeBtn" onclick="setMode('japan')">æ—¥æœ¬æ”¹å¤‰</button>
</div>

<!-- å³ -->
<div id="main">
    <div id="controls"></div>
    <div id="result"></div>
    <div id="map"></div>
</div>

<script>

let map = L.map('map').setView([20,0],2);
let marker = null;

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'Â© OpenStreetMap'
}).addTo(map);

function setMode(mode){

    const controls = document.getElementById("controls");
    document.getElementById("result").innerHTML="";

    if(mode === "country"){
        controls.innerHTML = `
            <input type="text" id="countryInput" placeholder="å›½åã‚’å…¥åŠ›">
            <button onclick="searchCountry()">æ¤œç´¢</button>
            <button onclick="randomCountry()">ãƒ©ãƒ³ãƒ€ãƒ </button>
        `;
    }

    if(mode === "region"){
        controls.innerHTML = `
            <select id="regionSelect">
                <option value="Asia">ã‚¢ã‚¸ã‚¢</option>
                <option value="Europe">ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘</option>
                <option value="Africa">ã‚¢ãƒ•ãƒªã‚«</option>
                <option value="Americas">ã‚¢ãƒ¡ãƒªã‚«å¤§é™¸</option>
                <option value="Oceania">ã‚ªã‚»ã‚¢ãƒ‹ã‚¢</option>
            </select>
            <button onclick="searchRegion()">è¡¨ç¤º</button>
        `;
    }

    if(mode === "japan"){
        controls.innerHTML = `
            <button onclick="focusJapan()">æ—¥æœ¬ã‚’å¼·èª¿è¡¨ç¤º</button>
        `;
    }
}

/* å›½æ¤œç´¢ */
async function searchCountry(){
    let name = document.getElementById("countryInput").value;
    let res = await fetch(`https://restcountries.com/v3.1/name/${name}`);
    let data = await res.json();
    showCountry(data[0]);
}

/* ãƒ©ãƒ³ãƒ€ãƒ  */
async function randomCountry(){
    let res = await fetch("https://restcountries.com/v3.1/all");
    let data = await res.json();
    let random = data[Math.floor(Math.random()*data.length)];
    showCountry(random);
}

/* åœ°åŸŸæ¤œç´¢ */
async function searchRegion(){
    let region = document.getElementById("regionSelect").value;
    let res = await fetch(`https://restcountries.com/v3.1/region/${region}`);
    let data = await res.json();
    let random = data[Math.floor(Math.random()*data.length)];
    showCountry(random);
}

/* è¡¨ç¤º */
function showCountry(country){

    if(marker){
        map.removeLayer(marker);
    }

    let lat = country.latlng[0];
    let lng = country.latlng[1];

    map.setView([lat,lng],5);
    marker = L.marker([lat,lng]).addTo(map);

    document.getElementById("result").innerHTML = `
        <h2>${country.name.common}</h2>
        <img src="${country.flags.png}">
        <p>é¦–éƒ½: ${country.capital ? country.capital[0] : "ãªã—"}</p>
        <p>äººå£: ${country.population.toLocaleString()}</p>
    `;
}

/* æ—¥æœ¬æ”¹å¤‰ */
function focusJapan(){
    map.setView([36,138],6);

    if(marker){
        map.removeLayer(marker);
    }

    marker = L.circle([36,138],{
        color:"red",
        fillColor:"red",
        fillOpacity:0.5,
        radius:500000
    }).addTo(map);

    document.getElementById("result").innerHTML = "<h2>ğŸ‡¯ğŸ‡µ æ—¥æœ¬å¼·èª¿è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰</h2>";
}

/* åˆæœŸè¡¨ç¤º */
setMode("country");

</script>

</body>
</html>
