<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>åœ°ç†ãŠåŠ©ã‘ãƒ„ãƒ¼ãƒ« å®Œå…¨ç‰ˆ</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#111;
    color:white;
    display:flex;
    height:100vh;
    overflow:hidden;
}

/* å·¦ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
#sidebar{
    width:230px;
    background:#1a1a1a;
    padding:15px;
    border-right:2px solid #333;
    box-sizing:border-box;
}

#sidebar h2{
    margin-top:0;
}

.modeBtn{
    display:block;
    width:100%;
    margin:8px 0;
    padding:10px;
    background:#222;
    border:none;
    color:white;
    cursor:pointer;
}

.modeBtn:hover{
    background:#333;
}

/* å³ */
#main{
    flex:1;
    display:flex;
    flex-direction:column;
    padding:15px;
    box-sizing:border-box;
}

#controls{
    margin-bottom:10px;
}

input,select,button{
    padding:8px;
    margin:5px;
}

button{
    cursor:pointer;
}

#result{
    min-height:120px;
}

.countryItem{
    cursor:pointer;
    padding:6px;
    border-bottom:1px solid #333;
}

.countryItem:hover{
    background:#222;
}

#result img{
    width:150px;
}

#map{
    flex:1;
    margin-top:10px;
}
</style>
</head>

<body>

<!-- å·¦ -->
<div id="sidebar">
    <h2>ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿</h2>
    <button class="modeBtn" onclick="setMode('country')">å›½æ¤œç´¢</button>
    <button class="modeBtn" onclick="setMode('region')">åœ°åŸŸæ¤œç´¢</button>
    <button class="modeBtn" onclick="setMode('japan')">æ—¥æœ¬åœ°å›³æ”¹å¤‰</button>
</div>

<!-- å³ -->
<div id="main">
    <div id="controls"></div>
    <div id="result"></div>
    <div id="map"></div>
</div>

<script>

let map = L.map('map').setView([20,0],2);
let marker = null;

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'Â© OpenStreetMap'
}).addTo(map);

/* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
function setMode(mode){

    const controls = document.getElementById("controls");
    document.getElementById("result").innerHTML="";

    if(mode === "country"){
        controls.innerHTML = `
            <input type="text" id="countryInput" placeholder="å›½åã‚’å…¥åŠ›">
            <button onclick="searchCountry()">æ¤œç´¢</button>
            <button onclick="randomCountry()">ãƒ©ãƒ³ãƒ€ãƒ å›½</button>
        `;
    }

    if(mode === "region"){
        controls.innerHTML = `
            <select id="regionSelect">
                <option value="Asia">ã‚¢ã‚¸ã‚¢</option>
                <option value="Europe">ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘</option>
                <option value="Africa">ã‚¢ãƒ•ãƒªã‚«</option>
                <option value="Americas">ã‚¢ãƒ¡ãƒªã‚«å¤§é™¸</option>
                <option value="Oceania">ã‚ªã‚»ã‚¢ãƒ‹ã‚¢</option>
            </select>
            <button onclick="searchRegion()">åœ°åŸŸä¸€è¦§è¡¨ç¤º</button>
        `;
    }

    if(mode === "japan"){
        controls.innerHTML = `
            <button onclick="focusJapan()">æ—¥æœ¬ã‚’å¼·èª¿è¡¨ç¤º</button>
        `;
    }
}

/* å›½æ¤œç´¢ */
async function searchCountry(){
    let name = document.getElementById("countryInput").value.trim();
    if(!name) return;

    try{
        let res = await fetch(`https://restcountries.com/v3.1/name/${name}`);
        if(!res.ok) throw new Error();
        let data = await res.json();
        if(!Array.isArray(data) || !data[0]) throw new Error();

        showCountry(data[0]);

    }catch{
        document.getElementById("result").innerHTML="âŒ å›½ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
    }
}

/* ãƒ©ãƒ³ãƒ€ãƒ  */
async function randomCountry(){
    try{
        let res = await fetch("https://restcountries.com/v3.1/all");
        if(!res.ok) throw new Error();
        let data = await res.json();
        if(!Array.isArray(data)) throw new Error();

        let random = data[Math.floor(Math.random()*data.length)];
        showCountry(random);

    }catch{
        document.getElementById("result").innerHTML="âŒ ãƒ©ãƒ³ãƒ€ãƒ å–å¾—å¤±æ•—";
    }
}

/* åœ°åŸŸæ¤œç´¢ï¼ˆä¸€è¦§è¡¨ç¤ºï¼‰ */
async function searchRegion(){

    let region = document.getElementById("regionSelect").value;

    try{
        let res = await fetch(`https://restcountries.com/v3.1/region/${region}`);
        if(!res.ok) throw new Error();

        let data = await res.json();
        if(!Array.isArray(data) || data.length===0) throw new Error();

        data.sort((a,b)=>a.name.common.localeCompare(b.name.common));

        let html = `<h3>${region} ã®å›½ä¸€è¦§</h3>
                    <div style="max-height:250px; overflow:auto;">`;

        data.forEach(country=>{
            html += `
                <div class="countryItem" onclick="showCountryByCode('${country.cca3}')">
                    ${country.name.common}
                </div>
            `;
        });

        html += "</div>";

        document.getElementById("result").innerHTML = html;

    }catch{
        document.getElementById("result").innerHTML="âŒ åœ°åŸŸå–å¾—å¤±æ•—";
    }
}

/* ã‚³ãƒ¼ãƒ‰ã§å†å–å¾—ï¼ˆå®‰å…¨è¡¨ç¤ºï¼‰ */
async function showCountryByCode(code){
    try{
        let res = await fetch(`https://restcountries.com/v3.1/alpha/${code}`);
        if(!res.ok) throw new Error();
        let data = await res.json();
        showCountry(data[0]);
    }catch{
        document.getElementById("result").innerHTML="âŒ å›½å–å¾—å¤±æ•—";
    }
}

/* è¡¨ç¤º */
function showCountry(country){

    if(marker){
        map.removeLayer(marker);
    }

    if(!country.latlng) return;

    let lat = country.latlng[0];
    let lng = country.latlng[1];

    map.setView([lat,lng],5);

    marker = L.marker([lat,lng]).addTo(map);

    document.getElementById("result").innerHTML = `
        <h2>${country.name.common}</h2>
        <img src="${country.flags.png}">
        <p>é¦–éƒ½: ${country.capital ? country.capital[0] : "ãªã—"}</p>
        <p>äººå£: ${country.population.toLocaleString()}</p>
        <p>åœ°åŸŸ: ${country.region}</p>
    `;
}

/* æ—¥æœ¬å¼·èª¿ */
function focusJapan(){

    if(marker){
        map.removeLayer(marker);
    }

    map.setView([36.2,138.2],6);

    marker = L.circle([36.2,138.2],{
        color:"red",
        fillColor:"red",
        fillOpacity:0.4,
        radius:600000
    }).addTo(map);

    document.getElementById("result").innerHTML = `
        <h2>ğŸ‡¯ğŸ‡µ æ—¥æœ¬å¼·èª¿è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰</h2>
    `;
}

/* åˆæœŸ */
setMode("country");

</script>

</body>
</html>
